<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🔥 Streak Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
      body {
        background: linear-gradient(to bottom right, #022c22, #000000);
        background-attachment: fixed;
        color: white;
        overflow-x: hidden;
        margin: 0;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        animation: fadeIn 0.3s forwards;
      }

      .modal-overlay.closing {
        animation: fadeOut 0.3s forwards;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }

      .modal-content {
        background: linear-gradient(to bottom right, #022c22, #000000);
        border: 1px solid #065f46;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        transform: scale(0.9);
        opacity: 0;
        animation: zoomIn 0.3s forwards 0.1s;
        padding: 20px;
      }

      .modal-content.closing {
        animation: zoomOut 0.3s forwards;
      }

      @keyframes zoomIn {
        from { transform: scale(0.9); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }

      @keyframes zoomOut {
        from { transform: scale(1); opacity: 1; }
        to { transform: scale(0.9); opacity: 0; }
      }

      .close-button {
        position: absolute;
        top: 15px;
        right: 15px;
        background: #065f46;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        z-index: 1001;
      }

      .close-button:hover {
        background: #047857;
        transform: rotate(90deg);
      }

      .form-button {
        background: linear-gradient(to right, #065f46, #047857);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 20px auto;
      }

      .form-button:hover {
        background: linear-gradient(to right, #047857, #059669);
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
      }

      .flag {
        position: absolute;
        top: 10px;
        left: -30px;
        background: linear-gradient(to bottom, #ffd700, #ffcc00);
        color: black;
        font-weight: bold;
        font-size: 16px;
        padding: 8px 16px;
        transform: rotate(-10deg);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        clip-path: polygon(0 0, 100% 0, 80% 100%, 0% 100%);
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #ffffff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Custom Bengali Form Styles */
      .bengali-form {
        font-family: 'Hind Siliguri', sans-serif;
        color: white;
      }
      
      .bengali-form h2 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 20px;
        color: #8e44ad;
        text-align: center;
      }
      
      .bengali-form .form-group {
        margin-bottom: 20px;
      }
      
      .bengali-form label {
        display: block;
        margin-bottom: 8px;
        font-size: 16px;
        font-weight: 600;
        color: #ecf0f1;
      }
      
      .bengali-form .required:after {
        content: " *";
        color: #e74c3c;
      }
      
      .bengali-form input,
      .bengali-form select,
      .bengali-form textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #34495e;
        border-radius: 8px;
        background-color: rgba(52, 73, 94, 0.5);
        color: white;
        font-size: 16px;
        font-family: 'Hind Siliguri', sans-serif;
        transition: all 0.3s;
      }
      
      .bengali-form input:focus,
      .bengali-form select:focus {
        outline: none;
        border-color: #8e44ad;
        background-color: rgba(52, 73, 94, 0.8);
        box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.3);
      }
      
      .bengali-form button[type="submit"] {
        background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
        color: white;
        padding: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 600;
        width: 100%;
        transition: all 0.3s;
        margin-top: 20px;
        font-family: 'Hind Siliguri', sans-serif;
      }
      
      .bengali-form button[type="submit"]:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      }
      
      .bengali-form .progress-container {
        margin: 25px 0;
      }
      
      .bengali-form .progress-bar {
        height: 12px;
        background-color: #34495e;
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 5px;
      }
      
      .bengali-form .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #8e44ad, #9b59b6);
        border-radius: 6px;
        transition: width 0.4s ease;
        width: 0%;
      }
      
      .bengali-form .progress-value {
        text-align: center;
        font-size: 24px;
        font-weight: 700;
        color: #8e44ad;
        margin-top: 10px;
      }
      
      .bengali-form input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        height: 15px;
        background: #34495e;
        border-radius: 8px;
        margin-top: 20px;
      }
      
      .bengali-form input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 25px;
        width: 25px;
        border-radius: 50%;
        background: #8e44ad;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: all 0.3s;
      }
      
      .bengali-form input[type=range]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 3px 8px rgba(0,0,0,0.3);
      }
      
      /* Success Animation */
      .success-animation {
        display: none;
        text-align: center;
        margin-top: 20px;
        animation: fadeIn 0.5s ease-in-out;
      }
      
      .checkmark {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        display: block;
        stroke-width: 6;
        stroke: #27ae60;
        stroke-miterlimit: 10;
        margin: 0 auto 20px;
        box-shadow: inset 0px 0px 0px #27ae60;
        animation: fill 0.6s ease-in-out 0.6s forwards, scale 0.5s ease-in-out 1.2s both;
      }
      
      .checkmark__circle {
        stroke-dasharray: 166;
        stroke-dashoffset: 166;
        stroke-width: 6;
        stroke-miterlimit: 10;
        stroke: #27ae60;
        fill: none;
        animation: stroke 0.8s cubic-bezier(0.65, 0, 0.45, 1) forwards;
      }
      
      .checkmark__check {
        transform-origin: 50% 50%;
        stroke-dasharray: 58;
        stroke-dashoffset: 58;
        animation: stroke 0.4s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
      }
      
      .success-message {
        color: #27ae60;
        font-weight: 700;
        margin-top: 20px;
        text-align: center;
        font-size: 22px;
        opacity: 0;
        animation: fadeIn 0.5s ease-in-out 1.4s forwards;
      }

      @keyframes stroke {
        100% {
          stroke-dashoffset: 0;
        }
      }

      @keyframes scale {
        0%, 100% {
          transform: none;
        }
        50% {
          transform: scale3d(1.1, 1.1, 1);
        }
      }

      @keyframes fill {
        100% {
          box-shadow: inset 0px 0px 0px 50px rgba(39, 174, 96, 0);
        }
      }
    </style>
  </head>
  <body>
    <div id="root" class="px-4 py-6"></div>

   <!-- Study Form Popup -->
<div id="studyFormPopup" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <button onclick="closeStudyForm()" class="close-button">
      ×
    </button>
    <div class="bengali-form">
      <h2 class="text-4xl font-bold text-center mb-6 animate-swing" style="animation-iteration-count: infinite; animation-duration: 3s;">কি খবর?</h2>
      <form id="studyForm">
        <div class="form-group">
          <label for="name" class="required">নাম:</label>
          <input type="text" id="name" name="name" required placeholder="আপনার নাম লিখুন">
        </div>
        
        <div class="form-group">
          <label for="date" class="required">তারিখ:</label>
          <input type="date" id="date" name="date" required>
        </div>
        
        <div class="form-group">
          <label for="hours" class="required">স্টাডি করা সময় (ঘণ্টা):</label>
          <input type="number" id="hours" name="hours" step="0.1" min="0" required placeholder="কত ঘণ্টা পড়ালেখা করলেন?">
        </div>
        
        <div class="form-group">
          <label for="goal">লক্ষ্য:</label>
          <input type="text" id="goal" name="goal" placeholder="আপনার লক্ষ্য কি?">
        </div>
        
        <div class="form-group">
          <label for="deadline">শেষ তারিখ:</label>
          <input type="date" id="deadline" name="deadline">
        </div>
        
        <div class="form-group progress-container">
          <label>প্রোগ্রেস:</label>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <input type="range" id="progress" name="progress" min="0" max="100" step="10" value="0" oninput="updateProgress(this.value)">
          <div class="progress-value" id="progressValue">০%</div>
        </div>
        
        <button type="submit" id="submitBtn">সাবমিট করুন</button>
      </form>
      
      <div class="success-animation" id="successAnimation">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
        <div class="success-message">সফলভাবে সাবমিট হয়েছে!</div>
      </div>
    </div>
  </div>
</div>


<style>
  /* Swing animation */
  @keyframes swing {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(3deg); }
    50% { transform: rotate(0deg); }
    75% { transform: rotate(-3deg); }
    100% { transform: rotate(0deg); }
  }
  
  .animate-swing {
    animation: swing 3s ease-in-out infinite;
    transform-origin: top center;
  }
  
  /* Update the h2 style in bengali-form */
  .bengali-form h2 {
    font-size: 2.5rem; /* 40px */
    font-weight: 700;
    margin-bottom: 1.5rem; /* 24px */
    color: #8e44ad;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
</style>

    <script>
      // Set default date to today
      function setDefaultDate() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = today;
      }
      
      // Update progress bar display
      function updateProgress(value) {
        document.getElementById('progressFill').style.width = value + '%';
        document.getElementById('progressValue').textContent = value + '%';
      }
      
      // Initialize progress bar
      function initProgressBar() {
        updateProgress(0);
      }
      
      // Study Form functions
      function openStudyForm() {
        const popup = document.getElementById('studyFormPopup');
        const content = document.querySelector('.modal-content');
        popup.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        setDefaultDate();
        initProgressBar();
        
        // Reset animation classes
        popup.classList.remove('closing');
        content.classList.remove('closing');
      }

      function closeStudyForm() {
        const popup = document.getElementById('studyFormPopup');
        const content = document.querySelector('.modal-content');
        
        // Add closing animation class
        popup.classList.add('closing');
        content.classList.add('closing');
        
        // Wait for animation to finish before hiding
        setTimeout(() => {
          popup.style.display = 'none';
          document.body.style.overflow = 'auto';
          
          // Remove closing classes for next open
          popup.classList.remove('closing');
          content.classList.remove('closing');
        }, 300);
      }

      // Close popup when clicking outside
      document.getElementById('studyFormPopup').addEventListener('click', function(e) {
        if (e.target === this) {
          closeStudyForm();
        }
      });
      
      // Handle form submission
      document.getElementById('studyForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'সাবমিট হচ্ছে...';
        
        // Hide any previous success message
        document.getElementById('successAnimation').style.display = 'none';
        
        // Get current timestamp
        const timestamp = new Date().toISOString();
        
        // Get form values
        const formData = {
          timestamp: timestamp,
          name: document.getElementById('name').value,
          date: document.getElementById('date').value,
          hours: parseFloat(document.getElementById('hours').value),
          goal: document.getElementById('goal').value,
          deadline: document.getElementById('deadline').value,
          progress: parseInt(document.getElementById('progress').value)
        };
        
        // Replace with your Google Apps Script deployment URL
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbzT9_z2v02qAEMLzXsvvdelaRQGR2ZS5IpWqCCCB2N5_ih076Q7Eg7WBGukJ-3wXkBxRg/exec';
        
        fetch(scriptUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        })
        .then(() => {
          // Show success animation
          document.getElementById('studyForm').style.display = 'none';
          document.getElementById('successAnimation').style.display = 'block';
          
          // Reset form after animation completes
          setTimeout(() => {
            document.getElementById('studyForm').reset();
            document.getElementById('studyForm').style.display = 'block';
            document.getElementById('successAnimation').style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.textContent = 'সাবমিট করুন';
            updateProgress(0);
            setDefaultDate();
            
            // Close the popup after 1 second
            setTimeout(closeStudyForm, 1000);
            
            // Refresh dashboard data
            if (window.refreshDashboard) {
              window.refreshDashboard();
            }
          }, 3000);
        })
        .catch(error => {
          console.error('Error:', error);
          alert('সাবমিট করতে সমস্যা হয়েছে। দয়া করে আবার চেষ্টা করুন।');
          submitBtn.disabled = false;
          submitBtn.textContent = 'সাবমিট করুন';
        });
      });
    </script>

    <script type="text/babel">
      const { useState, useEffect } = React;

      const StreakDashboard = () => {
        const [streakData, setStreakData] = useState([]);
        const [loading, setLoading] = useState(true);
        const [refreshTrigger, setRefreshTrigger] = useState(false);

        const googleSheetWebAppURL = "https://script.google.com/macros/s/AKfycbzT9_z2v02qAEMLzXsvvdelaRQGR2ZS5IpWqCCCB2N5_ih076Q7Eg7WBGukJ-3wXkBxRg/exec";

        const fetchData = () => {
          setLoading(true);
          fetch(googleSheetWebAppURL)
            .then((res) => res.json())
            .then((data) => {
              // Sort by This Week Studied (descending)
              const sortedData = data.sort((a, b) => b["This Week Studied"] - a["This Week Studied"]);
              setStreakData(sortedData);
              setLoading(false);
            })
            .catch((err) => {
              console.error("Fetch error:", err);
              setLoading(false);
            });
        };

        useEffect(() => {
          fetchData();
          
          // Make refreshDashboard available globally
          window.refreshDashboard = () => {
            setRefreshTrigger(prev => !prev);
          };
        }, [refreshTrigger]);

        const targetDate = new Date("2025-06-25");
        const today = new Date();
        const daysLeft = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24)));
        const motivation = "⏳ সময়কে কাজে লাগাও, স্বপ্ন হাতছানি দিচ্ছে!";

        return (
          <div className="max-w-7xl mx-auto space-y-8 pt-8">
            <div className="text-center space-y-2">
              <h1 className="text-4xl font-bold text-green-100">
                📆 {daysLeft.toLocaleString('bn')} দিন বাকি!
              </h1>
              <p className="text-lg text-green-300">{motivation}</p>
            </div>

            <button 
              onClick={openStudyForm} 
              className="form-button"
            >
              <i className="fas fa-plus"></i> Add Your Progress
            </button>

            {loading ? (
              <div className="text-center">
                <div className="loading-spinner"></div>
                <p className="text-green-300">Loading data...</p>
              </div>
            ) : (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {streakData.map((user, index) => (
                  <div
                    key={index}
                    className="relative rounded-3xl shadow-2xl border border-green-800 bg-gradient-to-br from-green-900 via-green-950 to-black hover:shadow-xl hover:shadow-green-700 transition-shadow duration-300 p-6 space-y-4"
                  >
                    {(index === 0 || index === 1 || index === 2) && (
                      <div className="flag">
                        🏆 {index === 0 ? "1st" : index === 1 ? "2nd" : "3rd"}
                      </div>
                    )}

                    <div className="flex items-center justify-between">
                      <h2 className="text-2xl font-semibold text-green-100">{user.Name}</h2>
                      <span className="text-sm font-medium text-white flex items-center gap-1">
                        {user.Streak >= 7 ? "🔥 On Fire" : (user.Streak >= 4 ? "⚡ Focused" : "🌱 Just Started")}
                      </span>
                    </div>

                    <div className="flex flex-col space-y-2 text-sm text-gray-300">
                      <div className="flex items-center gap-2">
                        <i className="fas fa-fire text-red-400 mr-2"></i> Streak:{" "}
                        <span className="font-medium text-white">{user.Streak} days</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <i className="fas fa-sun text-yellow-400 mr-2"></i> Today Studied:{" "}
                        <span className="font-medium text-white">{user["Today Studied"]}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <i className="fas fa-calendar-week text-blue-400 mr-2"></i> This Week:{" "}
                        <span className="font-medium text-white">{user["This Week Studied"]}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <i className="fas fa-chart-bar text-purple-400 mr-2"></i> Total Studied:{" "}
                        <span className="font-medium text-white">{user["Total Studied"]}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <i className="fas fa-star text-yellow-400 mr-2"></i> Points:{" "}
                        <span className="font-medium text-white">{user.Points}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <i className="fas fa-medal text-green-400 mr-2"></i> Levels:{" "}
                        <span className="font-medium text-white">{user.Levels}</span>
                      </div>
                    </div>

                    <div className="pt-4 border-t border-green-700 text-sm text-gray-200 space-y-2">
                      <div className="flex items-center gap-2">
                        <i className="fas fa-bullseye text-purple-400 mr-2"></i> Goal:{" "}
                        <span className="font-medium text-white">{user.Goal || "Not Set"}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <i className="fas fa-calendar-alt text-pink-400 mr-2"></i> Deadline:{" "}
                        <span className="font-medium text-white">
                          {user.Deadline ? new Date(user.Deadline).toLocaleDateString() : "Not Set"}
                        </span>
                      </div>
                      <div className="flex items-center gap-2">
                        <i className="fas fa-bolt text-yellow-400 mr-2"></i> Progress:
                        <div className="flex-1">
                          <div className="w-full bg-green-800 rounded-full h-3 ml-2">
                            <div
                              className="bg-green-400 h-3 rounded-full"
                              style={{ width: `${user.Progress || 0}%` }}
                            ></div>
                          </div>
                        </div>
                        <span className="ml-2 font-medium text-white">{user.Progress || 0}%</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}

            <footer className="text-center text-sm text-green-300 pt-6">
              🏁 Study Challenge | Designed by <span className="font-semibold text-white">Overclock Team</span>
            </footer>
          </div>
        );
      };

      ReactDOM.render(<StreakDashboard />, document.getElementById("root"));
    </script>
  </body>
</html>
